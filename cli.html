<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia Site Renderer 1.3 at Sep 6, 2013 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Maven - </title>
    <style type="text/css" media="all">
      @import url("./css/maven-base.css");
      @import url("./css/maven-theme.css");
      @import url("./css/site.css");
    </style>
    <link rel="stylesheet" href="./css/print.css" type="text/css" media="print" />
    <meta name="Date-Revision-yyyymmdd" content="20130906" />
    <meta http-equiv="Content-Language" content="en" />
        
        </head>
  <body class="composite">
    <div id="banner">
                        <a href="http://jboss.org/" id="bannerLeft">
                                                <img src="images/jbosscommunity_logo_stack_white.png" alt="ToDO" />
                </a>
                          <div id="bannerRight">
                                                <img src="images/vm-truckloader-logo.png" alt="VM Truck Loader logo" />
                </div>
            <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
            
                <div class="xleft">
        <span id="publishDate">Last Published: 2013-09-06</span>
                  &nbsp;| <span id="projectVersion">Version: 1.0</span>
                      </div>
            <div class="xright">        
            
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
            
                                <h5>VM Truckloader</h5>
                  <ul>
                  <li class="none">
                          <a href="index.html" title="Introduction">Introduction</a>
            </li>
                  <li class="none">
                          <a href="dev-set-up.html" title="Developer Environment Setup">Developer Environment Setup</a>
            </li>
                  <li class="none">
                          <a href="software-architecture.html" title="Software Architecture">Software Architecture</a>
            </li>
                  <li class="none">
            <strong>Usage</strong>
          </li>
                  <li class="none">
                          <a href="roadmap.html" title="Road Map">Road Map</a>
            </li>
          </ul>
                       <h5>Project Documentation</h5>
                  <ul>
                                                                                                                          <li class="collapsed">
                          <a href="project-info.html" title="Project Information">Project Information</a>
                  </li>
                                                                                                                                                              <li class="collapsed">
                          <a href="project-reports.html" title="Project Reports">Project Reports</a>
                  </li>
          </ul>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                   
            
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <h1>Usage</h1><p>This page documents how to use the tool and which arguments does it requires.</p><div class="section"><h2>Run the Java program<a name="Run_the_Java_program"></a></h2><p>First of all, the system running the program needs to have a Java Runtime Environement, also known as a JRE, installed and working. The simpliest way to check that is just to try ton run the command Java (either with cmd.exe or with a regular shell for non Windows system):</p>
<div class="source"><pre>$ java -version
</pre></div><p>If the command is recognized and displays a valid version of Java (above version 5), your system can run the tool.</p><p>The tool is packaged as a so called fat jar, which means that it is embedding all its dependencies, which make it very easy to run :</p>
<div class="source"><pre>$ java -cp target/VmSetup-1.0-SNAPSHOT-jar-with-dependencies.jar org.redhat.service.VmSetUp
The following options are required: -s, --server-url -p, --password -a, --action -u, --username
</pre></div><p>If you have copy and paste properly the arguments above, you should see the tool complaining about the missing parameter. Congratulations, you can pass to the next section of this tutorial :)</p></div><div class="section"><h2>Connection information<a name="Connection_information"></a></h2><p>Whatever you are trying to achieve with this tool, you will need to connect to a VMWare vCenter, which will requires appropriate credentials. So, you need to pass the following arguments to the tool:</p>
<div class="source"><pre>$ java -cp target/VmSetup-1.0-SNAPSHOT-jar-with-dependencies.jar org.redhat.service.VmSetUp \
    -s https://my.vcenter.url/sdk -u myUsername -p myPassword
</pre></div></div><div class="section"><h2>Specifying the action<a name="Specifying_the_action"></a></h2><p>The next required argument is the action you wish the tool to accomplish. The following actions are currently supported by this tool:</p>
<ul>
  <li>CREATE, will create new VMs based on the provided template name</li>
  <li>EDIT, will update the VMs CPU and memory settings</li>
  <li>DELETE, will delete the VMs - to use careful, there is no interactive confirmation !</li>
  <li>START, will start the VMs</li>
  <li>STOP, will stop the VMs</li>
  <li>RESTART, will stop and start the VMs</li>
</ul><p>Of course, up to this point you have not yet specified which VMs will be targeted by this action. This will be accomplished by the CSV file or the input line (see below).</p></div><div class="section"><h2>Specifying the template name<a name="Specifying_the_template_name"></a></h2><p>For the create action, an extra paramter is required - the template name. The tool will search for a template matching this name and use it as a base for the vm creation. The template is passed using the -t parameter:</p>
<div class="source"><pre>$ java -cp target/VmSetup-1.0-SNAPSHOT-jar-with-dependencies.jar org.redhat.service.VmSetUp \
    -s https://my.vcenter.url/sdk -u myUsername -p myPassword
    -a create -t myTemplateName
</pre></div></div><div class="section"><h2>Help<a name="Help"></a></h2><p>Note that once you have specified the four required parameters, you can ask the tool to print its help page:</p>
<div class="source"><pre>$ java -cp target/VmSetup-1.0-SNAPSHOT-jar-with-dependencies.jar org.redhat.service.VmSetUp \
    -s https://my.vcenter.url/sdk -u myUsername -p myPassword
    -a create -t myTemplateName --help
Usage: vm-set-up [options]
  Options:
  * -a, --action       Action to perform
    -f, --file         CSV file
    -h, --help         print help text
                       Default: false
    -l, --line         spec for one VM as a simple CSV line
  * -p, --password     vCenter password
    -e, --post-exec    Script to execute after VM creation - only valid for vm
                       creation action
  * -s, --server-url   URL to vCenter
    -t, --template     Name of the template to use - only valid for vm creation
                       action
  * -u, --username     vCenter username
</pre></div><p>_<i>This is a bit counter intuitive, but it is currently imposed by JCommander. Feel free to modify the code to make it better :)</i></p><h1>Virtual Machine Specification</h1><p>All the option above just let you pass the connection information and the action you wish to perform, but none of them let you specify wish VMs should be targeted or how they should be called when created. This is the purpose of the options line and file.</p></div><div class="section"><h2>Data structure<a name="Data_structure"></a></h2><p>As explains on the introduction page of this website, the purpose of this project is to offer a simple mechanism to bulk commands to the vCenter. To do so, the tool only requires a simple CSV file structured with the following informations:</p>
<div class="source"><pre>&quot;env&quot;; &quot;hostname&quot;; &quot;role&quot;; &quot;MAC&quot;; &quot;ipAddress&quot;; &quot;VLAN&quot;; &quot;resourcePoolName&quot;; &quot;datastoreName&quot;; &quot;folder&quot;, &quot;nbCpu&quot;; &quot;vRAM&quot;; &quot;diskSize&quot;
DEV;newserver.domain.com; a web server;;192.168.1.1;VLAN;RP_NAME;DS_NAME;FOLDER;2;4;10
</pre></div><p>Fields description: * env, a simple string to state to which environment (DEV,QA,) the VM belong. This field is <i>not</i> used by the tool. * hostname, this will be used as the VM name inside the vCenter, this is a crucial field, which is obviously required. * role, a field to describ the purpose of the VM, this value will end up in the VM annotation in vCenter * MAC, this field is not used by the tool, but, if requested to create a VM, it will update this entry with the MAC address of the created instance * ipAddress and VLAN are not used by the tool * resource pool name, datastore and folder will be used when creating VM (action create) but ignored otherwise * nbCpu, vRAM and diskSize are used during VM creation and VM edition</p></div><div class="section"><h2>One liner<a name="One_liner"></a></h2><p>For testing purpose, instead of using the file option to pass a CSV file, one can use the line option and specify, behind it, one CSV line that will be used. If a file is also passed using file, both will be processed by the tool.</p></div><div class="section"><h2>FAQ on the CSV format<a name="FAQ_on_the_CSV_format"></a></h2>
<ul>
  <li>What happens if the CSV line is invalid ? ** OpenCSV will fails to process it and the tool will stop before doing anything</li>
  <li>What happens if the CSV line is correct, but contains invalid information ** either the tools will fails and stop when it reaches this VM specification ** or the process will go anyway as the invalid(s) field(s) might be just *** ignored (not used) *** still correct enough to allow processing (exemple, 4 instead of 2 CPU)</li>
</ul><h1>Running a post execution script</h1><p>In case of the create action, the tool offer an extra parameter post-exec which allow to pass the name of a script that should be run after each VM creation. This allow for some basic automation such as: * declaring the VM into a DNS server * adding the VM metadata to CBBD , such as Cobbler * add the VM to monitoring tool such as Nagios * </p><p>The interface is rather crude and allow only to pass the script name. It will run the script with the same as the one who started the JVM of the tool, and only if the file exists (obvioulsy) and the file is executable. The tool will also pass all the information of the current CSV ine - including the MAC address if the VM was successfully created, as arguments of the script.</p></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
              Copyright &#169;                   2013.
          All Rights Reserved.      
            
                  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
